<!doctype html>
<html class="no-js" lang="zxx">
    <script src="https://unpkg.com/html5-qrcode@2.0.11/dist/html5-qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>GoalDiggers | Vouchers Marketplace</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="site.webmanifest">
    <link rel="shortcut icon" type="image/x-icon" href="../../static/img/favicon.ico">

    <!-- CSS here -->
    <link rel="stylesheet" href="../static/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/owl.carousel.min.css">
    <link rel="stylesheet" href="../static/css/flaticon.css">
    <link rel="stylesheet" href="../static/css/slicknav.css">
    <link rel="stylesheet" href="../static/css/animate.min.css">
    <link rel="stylesheet" href="../static/css/magnific-popup.css">
    <link rel="stylesheet" href="../static/css/fontawesome-all.min.css">
    <link rel="stylesheet" href="../static/css/themify-icons.css">
    <link rel="stylesheet" href="../static/css/slick.css">
    <link rel="stylesheet" href="../static/css/nice-select.css">
    <link rel="stylesheet" href="../static/css/style.css">
</head>

<body>
    <header>
        <!-- Header Start -->
        <div class="header-area">
            <div class="main-header header-sticky">
                <div class="container-fluid">
                    <div class="menu-wrapper">
                        <!-- Logo -->
                        <div class="logo">
                            <a href="index"><img src="../static/img/logo/logo2.jpg" style="width: 150px;"></a>
                        </div>
                        <!-- Main-menu -->
                        <div class="main-menu d-none d-lg-block">
                            <nav>                                                
                                <ul id="navigation">  
                                    <li><a href="index">Redeem Customer's QR</a></li>
                                    <li><a href="seller_dashboard">Statistics</a></li>
                                </ul>
                            </nav>
                        </div>
                        <!-- Header Right -->
                        <div class="header-right">
                            <ul>
                                <li> <a href="login"><span id="loginBtn">Login/Register</span></a></li>
                                <li> <span id='logoutBtn' onclick=logout() >Logout</span></li>
                            </ul>
                        </div>
                    </div>
                    <!-- Mobile Menu -->
                    <div class="col-12">
                        <div class="mobile_menu d-block d-lg-none"></div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Header End -->
    </header>
    <main>
        
        <!--? Popular Items Start -->
        <div class="popular-items section-padding30" style="
        padding-top: 120px;
        padding-bottom: 30px;">
            <div class="container">
                <!-- Section tittle -->
                <div class="row justify-content-center">
                    <div class="col-xl-7 col-lg-8 col-md-10">
                        <div class="section-tittle mb-70 text-center">
                            <h2>Statistics</h2>
                        </div>
                    </div>
                </div>
                <div class="row justify-content-center">
                        <div class="row justify-content-center pb-5">
                            <canvas id="myChart"></canvas>
                            
                        </div>
                        <div class="row justify-content-center pb-5">
                            <canvas id="myChart2"></canvas>
                        </div>
                        <div class="row justify-content-center pb-5">
                            <canvas id="myChart3"></canvas>
                        </div>
                </div>

            </div>

        </div>
        <!-- Popular Items End -->
    </main>
    <footer>
        <!-- Footer Start-->
        <hr>
        <div class="footer-area footer-padding">
            <div class="container">
                <div class="row d-flex justify-content-between">
                    <div class="col-xl-3 col-lg-3 col-md-5 col-sm-6">
                        <div class="single-footer-caption mb-50">
                            <div class="single-footer-caption mb-30">
                                <!-- logo -->
                                <div class="footer-logo mb-3">
                                    <a href="index"><img src="../static/img/logo/logo2.jpg" style="width: 200px;"></a>
                                </div>
                                <div class="footer-tittle">
                                    <div class="footer-pera">
                                        <p>Greener vouchers at your fingertips that won't clutter your wallet.</p>
                                        <p> Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved</p>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
    </footer>
    <!-- Footer End-->
    

    <!-- JS here -->
    <script>
        function logout(){
            window.sessionStorage.setItem("userid", '');
            window.location.href = '/login';
        }

        let userid = window.sessionStorage.getItem("userid");
        console.log(userid);

        if (userid==''){
            document.getElementById('logoutBtn').style.display = "none";
            document.getElementById('vouchersBtn').style.display = "none";
            document.getElementById('profileBtn').style.display = "none";
            document.getElementById('cartBtn').style.display = "none";
        } else {
            document.getElementById('loginBtn').style.display = "none";
        }
    </script>




    <script src="../static/js/vendor/modernizr-3.5.0.min.js"></script>
    <!-- Jquery, Popper, Bootstrap -->
    <script src="../static/js/vendor/jquery-1.12.4.min.js"></script>
    <script src="../static/js/popper.min.js"></script>
    <script src="../static/js/bootstrap.min.js"></script>
    <!-- Jquery Mobile Menu -->
    <script src="../static/js/jquery.slicknav.min.js"></script>

    <!-- Jquery Slick , Owl-Carousel Plugins -->
    <script src="../static/js/owl.carousel.min.js"></script>
    <script src="../static/js/slick.min.js"></script>

    <!-- One Page, Animated-HeadLin -->
    <script src="../static/js/wow.min.js"></script>
    <script src="../static/js/animated.headline.js"></script>
    <script src="../static/js/jquery.magnific-popup.js"></script>

    <!-- Scrollup, nice-select, sticky -->
    <script src="../static/js/jquery.scrollUp.min.js"></script>
    <script src="../static/js/jquery.nice-select.min.js"></script>
    <script src="../static/js/jquery.sticky.js"></script>
    
    <!-- contact js -->
    <script src="../static/js/contact.js"></script>
    <script src="../static/js/jquery.form.js"></script>
    <script src="../static/js/jquery.validate.min.js"></script>
    <script src="../static/js/mail-script.js"></script>
    <script src="../static/js/jquery.ajaxchimp.min.js"></script>
    
    <!-- Jquery Plugins, main Jquery -->	
    <script src="../static/js/plugins.js"></script>
    <script src="../static/js/main.js"></script>

    <!-- AM Charts -->
    <script src="https://cdn.amcharts.com/lib/version/4.10.20/core.js"></script>
    <script src="https://cdn.amcharts.com/lib/version/4.10.20/charts.js"></script>
    <script src="https://cdn.amcharts.com/lib/version/4.10.20/themes/material.js"></script>
    <script src="https://cdn.amcharts.com/lib/version/4.10.20/lang/de_DE.js"></script>
    <script src="https://cdn.amcharts.com/lib/version/geodata/4.1.21/germanyLow.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/material.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/lang/de_DE.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/geodata/germanyLow.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/fonts/notosans-sc.js"></script>



    <!-- Styles -->
<style>
    #chartdiv {
      width: 100%;
      height: 600px;
    }
    </style>
    
    <!-- Resources -->
    <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
    
    <!-- Chart code -->
<script>
    const CHART_COLORS = {
        red: 'rgb(255, 99, 132)',
        orange: 'rgb(255, 159, 64)',
        yellow: 'rgb(255, 205, 86)',
        green: 'rgb(75, 192, 192)',
        blue: 'rgb(54, 162, 235)',
        purple: 'rgb(153, 102, 255)',
        grey: 'rgb(201, 203, 207)'
    };
    var data = {};
    var dataObj = {};
    function loadData(resolve){
        var request = new XMLHttpRequest();
        request.open("GET", "http://127.0.0.1:5020/getPurchasesStat", true);
        request.setRequestHeader("Content-Type", "application/json");
        request.setRequestHeader("Access-Control-Allow-Headers", "Origin, X-Requested-With, Content-Type, Accept");
        request.setRequestHeader("Access-Control-Allow-Origin", "*");
        request.setRequestHeader("Access-Control-Allow-Methods", "*");
        request.setRequestHeader("Access-Control-Allow-Credentials", "True");
        request.onreadystatechange = function() {
            if(this.readyState == 4 && this.status == 200) {
                returnText = this.responseText;
                dataObj = JSON.parse(returnText);
                data = dataObj;
                resolve(1);
            }else{
                // console.log(this.responseText)
                //Prompt Error Message
            }
        };
        request.send();
    }

    function checkDataLoaded() {
        return new Promise(resolve => {
            loadData(resolve);
            });
    }   
    function loadChart(){
        var labels = [];
        var datasets = [];
        i = 0;
        var purchaseAmount = [];
        for (k in data){
            labels.push(k);
            purchaseAmount.push(data[k]['purchaseAmount']); 
        }
        var tmp = {};
        tmp['backgroundColor'] = Object.values(CHART_COLORS);
        tmp['data'] = purchaseAmount;
        tmp['labels'] = labels
        datasets.push(tmp);
        console.log(data);
        console.log(labels);
        console.log(datasets);
        var datat = {};
        datat['labels'] = labels;
        datat['datasets'] = datasets;
        console.log(datat);
        var config = {
            type: 'pie',
            data: datat,
            options: {
                responsive: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Purchase Amount by Brands ($)'
                    }
                },
            },
        };
        var myChart = new Chart(
            document.getElementById('myChart'),
            config
        );


        var labels = [];
        var datasets = [];
        i = 0;
        var purchaseAmount = [];
        for (k in data){
            labels.push(k);
            purchaseAmount.push(data[k]['numRedeemed']); 
        }
        var tmp = {};
        tmp['backgroundColor'] = Object.values(CHART_COLORS);
        tmp['data'] = purchaseAmount;
        tmp['labels'] = labels
        datasets.push(tmp);
        console.log(data);
        console.log(labels);
        console.log(datasets);
        var datat = {};
        datat['labels'] = labels;
        datat['datasets'] = datasets;
        console.log(datat);
        var config = {
            type: 'pie',
            data: datat,
            options: {
                responsive: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Number of Redeemed Vouchers by Brands'
                    }
                },
            },
        };
        var myChart = new Chart(
            document.getElementById('myChart2'),
            config
        );


        var labels = [];
        var datasets = [];
        i = 0;
        var purchaseAmount = [];
        for (k in data){
            labels.push(k);
            purchaseAmount.push(data[k]['numPurchased']); 
        }
        var tmp = {};
        tmp['backgroundColor'] = Object.values(CHART_COLORS);
        tmp['data'] = purchaseAmount;
        tmp['labels'] = labels
        datasets.push(tmp);
        console.log(data);
        console.log(labels);
        console.log(datasets);
        var datat = {};
        datat['labels'] = labels;
        datat['datasets'] = datasets;
        console.log(datat);
        var config = {
            type: 'pie',
            data: datat,
            options: {
                responsive: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: 'Number of Purchased Vouchers by Brands'
                    }
                },
            },
        };
        var myChart = new Chart(
            document.getElementById('myChart3'),
            config
        );
    }
    async function test(){
        await checkDataLoaded();
        loadChart();
    }
    test();
    
</script>
<style>
 #chartdiv2 {
   width: 100%;
     height: 500px;
   }
     </style>
    
    <!-- Resources -->
     <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
    
    <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>
    
//     <!-- Chart code -->
 
<style>
 #chartdiv3 {
width: 100%;
height: 800px;
}
</style>
    
<!-- Resources -->
 <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
 <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>

</body>
</html>